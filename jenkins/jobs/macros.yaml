
###############################################################################
# Project building routines
###############################################################################

- builder:
    name: node-git-prep
    builders:
        - shell: |
            #!/bin/bash
            if [ ! -d "/srv/git/infrastructure" ]; then
                mkdir -p "/srv/git/infrastructure"
                pushd "/srv/git/infrastructure"
                git init
                git remote add origin https://gerrit.asterisk.org/infrastructure
                popd
            fi
            pushd "/srv/git/infrastructure"
            git fetch origin
            git checkout master
            git pull
            popd

- builder:
    name: gerrit-git-prep
    builders:
        - shell: |
            #!/bin/bash
            export BRANCH={branch}
            sudo /srv/git/infrastructure/jenkins/scripts/gerrit-git-prep.sh https://gerrit.asterisk.org git://git.asterisk.org asterisk

- builder:
    name: build-asterisk
    builders:
        - shell: |
            #!/bin/bash
            sudo /srv/git/infrastructure/jenkins/scripts/build-asterisk.sh -v

- builder:
    name: run-asterisk-unittests
    builders:
        - shell: |
            #!/bin/bash
            sudo /srv/git/infrastructure/jenkins/scripts/build-asterisk.sh -v -e app_voicemail -e app_directory -e test_voicemail_api -e FILE_STORAGE -e DO_CRASH
        - shell: |
            #!/bin/bash
            /srv/git/infrastructure/jenkins/scripts/run-asterisk-unittests.sh


- builder:
    name: python-coverage
    builders:
        - shell: "/srv/git/infrastructure/jenkins/scripts/run-python-cover.sh"

- builder:
    name: pep8
    builders:
        - shell: |
            #!/bin/bash
            export PYTHON_DIR={python_dir}
            export PEP8_OUTPUT={pep8_output}
            /srv/git/infrastructure/jenkins/scripts/run-pep8.sh

