
###############################################################################
# Project building routines
###############################################################################

- builder:
    name: node-git-prep
    builders:
        - shell: |
            #!/bin/bash
            if [ ! -d "/srv/git/infrastructure" ]; then
                mkdir -p "/srv/git/infrastructure"
                pushd "/srv/git/infrastructure"
                git init
                git remote add origin https://gerrit.asterisk.org/infrastructure
                popd
            fi
            pushd "/srv/git/infrastructure"
            git fetch origin
            git checkout master
            git pull
            popd

- builder:
    name: gerrit-git-prep
    builders:
        - shell: |
            #!/bin/bash
            export BRANCH={branch}
            /srv/git/infrastructure/jenkins/scripts/gerrit-git-prep.sh https://gerrit.asterisk.org git://git.asterisk.org asterisk

- builder:
    name: build-asterisk
    builders:
        - shell: |
            #!/bin/bash
            export DISABLE_OPTIONS={disables}
            export ENABLE_OPTIONS={enables}
            pushd asterisk
            /srv/git/infrastructure/jenkins/scripts/build-asterisk.sh ${DISABLE_OPTIONS} ${ENABLE_OPTIONS} -v
            popd asterisk

- builder:
    name: run-asterisk-unittests
    builders:
        - shell: |
            #!/bin/bash
            pushd asterisk
            /srv/git/infrastructure/jenkins/scripts/run-asterisk-unittests.sh
            popd asterisk


- builder:
    name: python-coverage
    builders:
        - shell: "/srv/git/infrastructure/jenkins/scripts/run-python-cover.sh"

- builder:
    name: pep8
    builders:
        - shell: |
            #!/bin/bash
            export PYTHON_DIR={python_dir}
            export PEP8_OUTPUT={pep8_output}
            /srv/git/infrastructure/jenkins/scripts/run-pep8.sh

